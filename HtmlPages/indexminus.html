<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Twitter Clone</title>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css" integrity="sha512-SzlrxWUlpfuzQ+pcUCosxcglQRNAq/DZjVsC0lE40xsADsfeQoEypE+enwcOiGjk/bSuGGKHEyjSoQ1zVisanQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="../HtmlPages/css/styles.css">
</head>
<body>

<!-- Sidebar Starts-->
<div class="sidebar light-mode">
    <div hidden="hidden">
        <p type="text" id="token" ></p>
    </div>
    <div class="logo">
        <img class="logoo" src="../HtmlPages/images/logodark.png" alt="">
    </div>
    <div onclick="homepage()" class="sidebarOption active">
        <span class="material-symbols-outlined">home</span>
        <h2>Home</h2>
    </div>
    <div onclick="mypost()" class="sidebarOption">
        <span class="material-symbols-outlined">list_alt</span>
        <h2>My Posts</h2>
    </div>
    <div onclick="profile()" class="sidebarOption">
        <span  class="material-symbols-outlined">person</span>
        <h2>Profile</h2>
    </div>

    <button class="sidebar__tweet logoutbutton" onclick="logout()">Log Out</button>
</div>
<!-- Sidebar Ends-->

<!-- Feed Starts-->
<div class="feed">
    <div class="feed__header">
        <h2>Home</h2>
    </div>

    <!-- tweetbox Starts-->
    <div class="tweetbox">
        <form>
            <div class="tweetbox__input">
                <input id="content" type="text" class="postsend" placeholder="What's happening?" >

            </div>
            <button class="tweetBox__tweetButton cawbutton" onclick="cawPost()">Caw</button>
        </form>
    </div>
    <!-- tweetbox ends-->

    <!-- posts starts-->
    <!--        <ul id="list">-->
    <!--            <li>-->
    <!--        <form enctype="multipart/form-data">-->
    <div id="feed"> </div>
    <!--        </form>-->

    <!--            </li>-->

    <!--        </ul>-->




    <!-- posts ends-->
    <div class="container">
        <div class="pagination-wrapper">
            <svg onclick="indexminus" class="btn btn--prev" height="96" viewBox="0 0 24 24" width="96" xmlns="http://www.w3.org/2000/svg">
                <path d="M15.41 16.09l-4.58-4.59 4.58-4.59L14 5.5l-6 6 6 6z" />
                <path d="M0-.5h24v24H0z" fill="none" />
            </svg>

            <div class="pagination-container">
                <div class="little-dot  little-dot--first"></div>
                <div class="little-dot">
                    <div class="big-dot-container">
                        <div class="big-dot"></div>
                    </div>
                </div>
                <div class="little-dot  little-dot--last"></div>
            </div>

            <svg onclick="indexplus()" class="btn btn--next" height="96" viewBox="0 0 24 24" width="96" xmlns="http://www.w3.org/2000/svg">
                <path d="M8.59 16.34l4.58-4.59-4.58-4.59L10 5.75l6 6-6 6z" />
                <path d="M0-.25h24v24H0z" fill="none" />
            </svg>
        </div>
    </div>
</div>
<!-- Feed Ends-->





<script>

    function profile(){
        window.location.href = 'http://localhost:63342/TwitterReplica_Crower/HtmlPages/profile.html';
    }

    function homepage(){
        window.location.href = 'http://localhost:63342/TwitterReplica_Crower/HtmlPages/index.html';
    }

    function logout(){
        sessionStorage.setItem("token", null);
        window.location.href = 'http://localhost:63342/TwitterReplica_Crower/HtmlPages/login.html';

    }
    function mypost(){
        window.location.href = 'http://localhost:63342/TwitterReplica_Crower/HtmlPages/mypost.html';

    }

    function indexplus(){
        window.location.href = 'http://localhost:63342/TwitterReplica_Crower/HtmlPages/indexplus.html';

    }



    window.addEventListener('load', getData);

    function foreachpost(result){
        result.map(post => {
            const postDiv = document.createElement('div');
            postDiv.classList.add('post');


            const bodyDiv = document.createElement('div');
            bodyDiv.classList.add('post__body');

            const headerDiv = document.createElement('div');
            headerDiv.classList.add('post__header');

            const headerTextDiv = document.createElement('div');
            headerTextDiv.classList.add('post__headerText');
            const nameH3 = document.createElement('h3');
            const nameSpan = document.createElement('span');
            nameSpan.classList.add('post__headerSpecial');
            nameSpan.innerText = post.username;
            nameH3.appendChild(nameSpan);
            headerTextDiv.appendChild(nameH3);
            headerDiv.appendChild(headerTextDiv);

            const headerDescDiv = document.createElement('div');
            headerDescDiv.classList.add('post__headerDescription');
            const contentP = document.createElement('p');
            contentP.innerText = post.content;
            headerDescDiv.appendChild(contentP);
            headerDiv.appendChild(headerDescDiv);

            bodyDiv.appendChild(headerDiv);

            const timeDiv = document.createElement('div');
            timeDiv.classList.add('post__timer');
            const dateSpan = document.createElement('span');
            dateSpan.innerText = post.date;
            dateSpan.classList.add('post__date');
            timeDiv.appendChild(dateSpan);
            const timeSpan = document.createElement('span');
            timeSpan.innerText = post.time;
            timeSpan.classList.add('post__time');
            timeDiv.appendChild(timeSpan);

            bodyDiv.appendChild(timeDiv);

            const footerDiv = document.createElement('div');
            footerDiv.classList.add('post__footer');
            const likeCommentSpan = document.createElement('span');
            likeCommentSpan.classList.add('material-symbols-outlined', 'likecomment');
            likeCommentSpan.innerText = 'chat';
            footerDiv.appendChild(likeCommentSpan);
            const favoriteSpan = document.createElement('span');
            favoriteSpan.classList.add('material-symbols-outlined', 'favcomment');
            favoriteSpan.innerText = 'favorite';
            footerDiv.appendChild(favoriteSpan);

            bodyDiv.appendChild(footerDiv);

            postDiv.appendChild(bodyDiv);

            document.getElementById('feed').appendChild(postDiv);
        });
    }

    function getData() {
        const token = sessionStorage.getItem("token");
        const name = document.getElementById('name');
        const username = document.getElementById('username');
        const content = document.getElementById('content');
        const date = document.getElementById('date');
        const time = document.getElementById('time');

        const data = JSON.stringify({
            "name": name,
            "username": username,
            "content": content,
            "date":date,
            "time":time
        });

        fetch("http://localhost:6160/post/findallpageplus", {
            method: 'POST',
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify(data)
        })
            .then(response => response.json())
            .then(result => { foreachpost(result.content)

            })
            .catch(error => console.log('error', error));
    }



    //*****************************Caw TuÅŸu
    function cawPost(){
        let token = sessionStorage.getItem("token");
        const content = document.getElementById('content').value;

        const data = {
            "content": content,
            "token": token
        }

        fetch("http://localhost:6260/user/createPost",{
            method: 'POST',
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify(data)
        })
            .then((response)=>response.json())
            .then((response)=>{
                if (response===true){
                    console.log("Lets go")
                    window.location.href = 'http://localhost:63342/TwitterReplica_Crower/HtmlPages/index.html';
                }
                else{
                    console.log(response.message)
                    alert(response.message)
                }
            })
            .catch((err) => {
                console.log(err)
            });
    }



</script>
<script src="../HtmlPages/js/pagination.js"></script>
</body>
</html>
