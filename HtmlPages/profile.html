<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&display=swap"
          rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,1,0"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css"
          integrity="sha512-SzlrxWUlpfuzQ+pcUCosxcglQRNAq/DZjVsC0lE40xsADsfeQoEypE+enwcOiGjk/bSuGGKHEyjSoQ1zVisanQ=="
          crossorigin="anonymous" referrerpolicy="no-referrer"/>
    <link rel="stylesheet" href="css/profile.css">
    <link rel="stylesheet" href="sweetalert2.min.css">
</head>
<body>

<header>
    <h1 onclick="homepage()"><img class="header__logo"  src="../HtmlPages/images/pawprint.png" alt="">Pawer</h1>
    <nav>
        <ul>
            <li><a class="aboutus" onclick="aboutus()">About Us</a></li>
            <section>
                <span onclick="lightdarkmode()" class="material-symbols-outlined" id="dark_mode">
                dark_mode</span>
            </section>
        </ul>
    </nav>
</header>

<main>

    <aside>
        <section onclick="homepage()" class="aside__deactive">
            <p>Home</p>
        </section>

        <section onclick="otherpeople4()" class="aside__deactive">
            <p>People</p>
        </section>

        <section onclick="friendRequest()" class="aside__deactive">
            <section class="aside__requestcount">
                <p>Requests</p>
                <p id="friendrequestcount"></p>
            </section>
        </section>

        <section onclick="mypost()" class="aside__deactive">
            <p>My Posts</p>
        </section>

        <section onclick="favpostpage()" class="aside__deactive">
            <p>Fav Posts </p>
        </section>

        <section onclick="discoverpage()" class="aside__deactive">
            <p>Discover</p>
        </section>

        <section class="aside__profile">
            <section class="aside__profile__mini">
                <img src="https://i.pinimg.com/564x/a6/58/32/a65832155622ac173337874f02b218fb--people-icon-avatar.jpg" alt="">
                <p>Profile</p>
            </section>
                <p class="updateprofile" onclick="profile()">Update Profile</p>
                <p class="changepassword" onclick="changepasslink()">Change Password</p>
        </section>
        <button onclick="logout()" class="logout">Log Out</button>
    </aside>

    <section class="main__section">
        <!-- pawerbox Starts-->
        <section class="main__section__mini">
            <label>
                <img src="https://i.pinimg.com/564x/a6/58/32/a65832155622ac173337874f02b218fb--people-icon-avatar.jpg" alt="">
            </label>
            <label>
                <span>Username</span>
                <input type="text" id="username" readonly/>
            </label>
            <label>
                <span>Name</span>
                <input type="text" id="name"/>
            </label>
            <label>
                <span>Surname</span>
                <input type="text" id="surname"/>
            </label>
            <label>
                <span>Age</span>
                <input type="text" id="age" />
            </label>
        </section>


            <button type="submit" class="submitbutton" onclick="update()">Update</button>

        <!-- pawerbox ends-->
    </section>

</main>


<script>

    let mode = document.getElementById('dark_mode');
    console.log(mode.textContent)

    function lightdarkmode() {
        document.body.classList.toggle("dark-theme");
        if (document.body.classList.contains("dark-theme")) {
            mode.textContent = 'light_mode';
            mode.id = 'light_mode';
            console.log(mode.textContent)
            console.log(mode.id)
        } else {
            mode.textContent = "dark_mode";
            mode.id = 'dark_mode';
        }

    }

    window.addEventListener('load', getfriendrequestcount);

    function profile(){
        window.location.href = 'http://localhost:63342/SocialMedia_Pawer/HtmlPages/profile.html';
    }
    function changepasslink(){
        window.location.href = 'http://localhost:63342/SocialMedia_Pawer/HtmlPages/changepass.html';
    }

    function homepage(){
        window.location.href = 'http://localhost:63342/SocialMedia_Pawer/HtmlPages/index.html';
    }

    function mypost(){
        window.location.href = 'http://localhost:63342/SocialMedia_Pawer/HtmlPages/mypost.html';
    }
    function favpostpage(){
        window.location.href = 'http://localhost:63342/SocialMedia_Pawer/HtmlPages/favposts.html';
    }
    function discoverpage(){
        window.location.href = 'http://localhost:63342/SocialMedia_Pawer/HtmlPages/discover.html';
    }
    function otherpeople4(){
        window.location.href = 'http://localhost:63342/SocialMedia_Pawer/HtmlPages/otherpeople4.html';
    }
    function friendRequest(){
        window.location.href = 'http://localhost:63342/SocialMedia_Pawer/HtmlPages/friendrequests.html';
    }

    function aboutus(){
        window.location.href = 'http://localhost:63342/SocialMedia_Pawer/HtmlPages/aboutus.html';
    }

    function logout(){
        sessionStorage.setItem("token", null);
        window.location.href = 'http://localhost:63342/SocialMedia_Pawer/HtmlPages/login.html';
    }

    function deleteuser(){
        Swal.fire({
            title: 'Are you sure?',
            text: "You won't be able to revert this!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes, delete it!'
        }).then((result) => {
            if (result.isConfirmed) {

                Swal.fire(
                    'Deleted!',
                    'Your file has been deleted.',
                    'success'
                )
                window.location.href = 'http://localhost:63342/TwitterReplica_Crower/HtmlPages/login.html';
            }
        })

    }

    window.addEventListener('load', getData);

    function getData(){
        const token = sessionStorage.getItem("token");
        const data = {
            "token": token,
        }

        fetch("http://localhost:6260/user/findbyid?token="+token,{
            method: 'POST',
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify(data)
        })
            .then((response)=>response.json())
            .then((result)=>{
                    console.log("Lets go")
                document.getElementById('username').value = result.username ;
                document.getElementById('name').value = result.name ;
                document.getElementById('surname').value = result.surname ;
                document.getElementById('age').value = result.age ;
            })
            .catch((err) => {
                console.log(err)
            });
    }


    function update() {
        const token = sessionStorage.getItem("token");
        const username = document.getElementById('username').value;
        const name = document.getElementById('name').value;
        const surname = document.getElementById('surname').value;
        const age = document.getElementById('age').value;
        if(age === undefined){
            document.getElementById('age').hidden = "hidden";
        }
        const data = {
            "username": username,
            "name": name,
            "surname": surname,
            "token":token,
            "age":age
        };

        fetch("http://localhost:6260/user/update", {
            method: 'POST',
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify(data)
        })
            .then(response => response.json())
            .then(response => {
                if (response===true) {
                    Swal.fire({
                        position: 'top-end',
                        icon: 'success',
                        title: 'Your work has been saved',
                        showConfirmButton: false,
                        timer: 1500
                    })
                    console.log("Lets go")
                }else{
                    console.log(response.message)
                    alert(response.message)
                }
            })

            .catch(error => console.log('error', error));
    }
    function getfriendrequestcount(){
        const token = sessionStorage.getItem("token");
        const data = {
            "token": token
        }

        fetch("http://localhost:6260/user/findallrequestscount",{
            method : "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify(data)
        })
            .then((response)=>response.json())
            .then((response)=>{
                if (response !== 0){
                    document.getElementById('friendrequestcount').innerHTML = response

                }
                else{
                    console.log(response.message);
                    document.getElementById('friendrequestcount').hidden = "hidden";
                }
            })
            .catch((err) => {

                console.log(err)
            });
    }

</script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


</body>
</html>